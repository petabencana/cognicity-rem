<template>

  <require from="leaflet/leaflet.css"></require>
  <require from="./styles.css"></require>

  <div class="map">

    <!-- Error Message Box -->
    <div if.bind="error" class="alert alert-danger" role="alert">
      <span class="sr-only">Error:</span>
      ${error}
    </div>

    <loading-indicator loading.bind="loading"></loading-indicator>

    <!-- Map -->
    <div id="mapContainer" style="height:${mapHeight}px;"></div>

    <div class="btn-toolbar">
      <div class="row">
        <div class="col-md-4 text-left">
          <select value.bind="selectedDistrict" change.delegate="districtChanged(selectedDistrict)" class="select-district">
            <option value.bind="null">${!districts ? 'Loading' : 'Select a district'}</option>
            <option repeat.for="district of districts" value.bind="district">${district}</option>
          </select>
          <!--<span class="district-flood-count" if.bind="selectedDistrict">${selectedDistrict.reports ? selectedDistrict.reports : 0} Flood ${selectedDistrict.reports === 1 ? 'Report' : 'Reports'}</span>-->
        </div>
        <div class="col-md-4 text-center">
          <div class="btn-group">
            <button click.delegate="refreshFloodStates()" class="btn btn-primary">Refresh Flood States</button>
            <button click.delegate="clearFloodStates()" class="btn btn-danger" if.bind="isEditor">Clear Flood States</button>
          </div>
        </div>
        <div class="col-md-4 text-right">
          <div class="pull-right" style="visibility: ${refreshing ? 'visible' : 'hidden'}">
            <img class="spinner" src="assets/icons/spinner.svg"/>
          </div>
        </div>
      </div>
    </div>

    <!-- Data Table -->
    <div id="tableContainer" style="overflow-y: scroll; height:${tableHeight}px;">
      <table class="table table-striped" aurelia-table="data.bind: tableData;
        display-data.bind: $areas; api.bind: tableApi;">
        <thead>
          <tr>
            <th class="col-md-1">ID</th>
            <th class="col-md-3">Name</th>
            <th class="col-md-3">City</th>
            <th class="col-md-2">Geom ID</th>
            <th class="col-md-1">Reports</th>
            <th class="col-md-2">State</th>
          </tr>
        </thead>
        <tbody>
          <tr repeat.for="area of $areas" aut-select="row.bind: area; selected-class: info"
            select.delegate="areaSelectedInTable($event)">
            <td>${area.properties.area_id}</td>
            <td>${area.properties.area_name}</td>
            <td>${area.properties.city_name}</td>
            <td>${area.properties.geom_id}</td>
            <td>${area.properties.reports}</td>
            <td>
              <select value.bind="area.properties.state" if.bind="isEditor && area === selectedArea"
                change.delegate="floodStateChanged(area)">
                <option repeat.for="state of floodStates" model.bind="state">${state.severity}</option>
              </select>
              <span if.bind="!isEditor || area !== selectedArea">${area.properties.state | floodState}</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</template>
