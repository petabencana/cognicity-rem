{"version":3,"sources":["api.js","app.js","environment.js","home.js","main.js","map.js","utils.js","resources/index.js","resources/elements/loading-indicator.js"],"names":["DATA_URL","auth","headers","localStorage","getItem","API","http","isRequesting","getInfrastructure","type","fetch","then","response","status","Error","json","catch","err","console","log","self","AUTH0_CLIENT_ID","AUTH0_DOMAIN","App","api","i18n","lock","Auth0Lock","isAuthenticated","on","authResult","getProfile","idToken","error","profile","setItem","JSON","stringify","hide","configureRouter","config","router","title","tr","options","pushState","root","map","route","moduleId","name","login","show","logout","removeItem","debug","testing","Home","message","configure","Promise","longStackTraces","warnings","wForgottenReturn","aurelia","use","standardConfiguration","feature","developmentLogging","plugin","instance","i18next","setup","backend","loadPath","lng","attributes","fallbackLng","start","setRoot","L","region","bounds","sw","ne","Map","data","waterways","pumps","floodgates","attached","attributionControl","fitBounds","tileLayer","tile_layer","attribution","detectRetina","subdomains","minZoom","maxZoom","ext","addTo","canActivate","jwtDecode","tokenIsExpired","jwt","jwtExp","exp","expiryDate","Date","setUTCSeconds","globalResources","nprogress","showSpinner","LoadingIndicator","defaultValue","loadingChanged","newValue","done"],"mappings":"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","file":"app-bundle.js","sourcesContent":["import { inject } from 'aurelia-framework';\nimport { HttpClient } from 'aurelia-fetch-client';\n\n// TODO: Move to environment variable\n// URL for Cognicity Data API\nconst DATA_URL = 'https://data.petabencana.id';\n\n// Authentication headers\nconst auth = { headers: { 'Authorization': 'Bearer ' + localStorage.getItem('id_token') } }\n\n// Wrapper class for API calls to Cognicity Data API\n@inject(HttpClient)\nexport class API {\n\n  // Initialize requesting status\n  isRequesting = false;\n\n  // Build the class injecting the HTTP client\n  constructor(http) {\n    this.http = http;\n    var self = this;\n  }\n\n  // TODO: Error handling\n  // Get infrastructure\n  getInfrastructure = (type) => {\n    this.isRequesting = true;\n    return this.http.fetch(`${DATA_URL}/infrastructure/${type}`, auth)\n    .then((response) => {\n      this.isRequesting = false;\n      if (response.status >= 400) throw new Error('Error calling data server');\n      else return response.json();\n    })\n    .catch((err) => {\n      this.isRequesting = false;\n      console.log('Error calling data server');\n      throw new Error('Error calling data server', err);\n    });\n  }\n\n}\n","import { inject } from 'aurelia-framework';\nimport { I18N } from 'aurelia-i18n';\n\nimport { API } from './api';\nimport { tokenIsExpired } from './utils';\n\n// TODO: Move into environment variables\n// TODO: Check credentials and log an error if incorrect\nconst AUTH0_CLIENT_ID = '';\nconst AUTH0_DOMAIN = '';\n\n@inject(API, I18N)\nexport class App {\n\n  lock = new Auth0Lock(AUTH0_CLIENT_ID, AUTH0_DOMAIN);\n  isAuthenticated = false;\n\n  constructor(api, i18n) {\n    this.api = api;\n    this.i18n = i18n;\n    var self = this;\n\n    if (tokenIsExpired()) {\n      this.isAuthenticated = false;\n    } else {\n      this.isAuthenticated = true;\n    }\n\n    this.lock.on(\"authenticated\", (authResult) => {\n      self.lock.getProfile(authResult.idToken, (error, profile) => {\n        if (error) {\n          // Handle error\n          return;\n        }\n\n        localStorage.setItem('id_token', authResult.idToken);\n        localStorage.setItem('profile', JSON.stringify(profile));\n        self.isAuthenticated = true;\n        self.lock.hide();\n      });\n    });\n  }\n\n  configureRouter(config, router){\n    config.title = this.i18n.tr('title');\n    config.options.pushState = true;\n    config.options.root = '/';\n    config.map([\n      { route: '', moduleId: 'home', name: 'home', title: 'Home' },\n      { route: 'map', moduleId: 'map', name: 'map', title: 'Map' }\n    ]);\n\n    this.router = router;\n  }\n\n  login() {\n    this.lock.show();\n  }\n\n  logout() {\n    localStorage.removeItem('profile');\n    localStorage.removeItem('id_token');\n    this.isAuthenticated = false;\n  }\n}\n","export default {\n  debug: true,\n  testing: true\n};\n","export class Home {\n  constructor() {\n    this.message = \"Welcome Home\";\n  }\n}\n","import environment from './environment';\nimport {I18N} from 'aurelia-i18n';\nimport Backend from 'i18next-xhr-backend';\n\n//Configure Bluebird Promises.\nPromise.config({\n  longStackTraces: environment.debug,\n  warnings: {\n    wForgottenReturn: false\n  }\n});\n\nexport function configure(aurelia) {\n  aurelia.use\n  .standardConfiguration()\n  .feature('resources');\n\n  if (environment.debug) {\n    aurelia.use.developmentLogging();\n  }\n\n  if (environment.testing) {\n    aurelia.use.plugin('aurelia-testing');\n  }\n\n  aurelia.use\n    .plugin('aurelia-i18n', (instance) => {\n      instance.i18next.use(Backend);\n      return instance.setup({\n        backend: {\n          loadPath: './locales/{{lng}}/{{ns}}.json'\n        },\n        lng : 'id',\n        attributes : ['t','i18n'],\n        fallbackLng : 'en',\n        debug : true\n      });\n    });\n\n  aurelia.start().then(() => aurelia.setRoot());\n}\n","import { inject } from 'aurelia-framework';\nimport { Redirect } from 'aurelia-router';\nimport { I18N } from 'aurelia-i18n';\n\nimport * as L from 'leaflet';\n\nimport { API } from './api';\nimport { tokenIsExpired } from './utils';\n\nconst config = {\n  region: 'jbd',\n  bounds: {\n    sw: [-6.733, 106.480],\n    ne: [-5.880, 107.175]\n  }\n}\n\n@inject(API, I18N)\nexport class Map {\n\n  constructor(api, i18n) {\n    this.api = api;\n    this.i18n = i18n;\n    var self = this;\n    this.message = \"I'm the Map\";\n\n    // Load the various types of infrastructure\n    api.getInfrastructure('waterways')\n    .then((data) => this.waterways = JSON.stringify(data))\n    .catch((err) => this.error = err.message);\n    api.getInfrastructure('pumps')\n    .then((data) => this.pumps = JSON.stringify(data))\n    .catch((err) => this.error = err.message);\n    api.getInfrastructure('floodgates')\n    .then((data) => this.floodgates = JSON.stringify(data))\n    .catch((err) => this.error = err.message);\n  }\n\n  attached() {\n\n    // Create map\n    this.map = L.map('mapContainer', {\n      attributionControl: false\n    }).fitBounds([config.bounds.sw, config.bounds.ne]);\n\n    // Add base map\n    L.tileLayer(self.config.tile_layer, {\n      attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OSM</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC BY-SA</a>, Imagery &copy; <a href=\"http://mapbox.com\">Mapbox</a>',\n      detectRetina: true,\n      subdomains: 'abcd',\n      minZoom: 0,\n      maxZoom: 18,\n      ext: 'png'\n    }).addTo(this.map);\n\n  }\n\n  canActivate() {\n    if(tokenIsExpired()) {\n      return new Redirect('');\n    } else {\n      return true;\n    }\n  }\n\n}\n","\nconst jwtDecode = require('jwt-decode');\n\nexport function tokenIsExpired() {\n  let jwt = localStorage.getItem('id_token')\n  if(jwt) {\n    let jwtExp = jwtDecode(jwt).exp;\n    let expiryDate = new Date(0);\n    expiryDate.setUTCSeconds(jwtExp);\n\n    if(new Date() < expiryDate) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","export function configure(config) {\n  config.globalResources(['./elements/loading-indicator']);\n}\n","import * as nprogress from 'nprogress';\nimport { bindable, noView, decorators } from 'aurelia-framework';\n\n// Do not show the spinner\nnprogress.configure({ showSpinner: false });\n\nexport let LoadingIndicator = decorators(\n  noView(['nprogress/nprogress.css']),\n  bindable({name: 'loading', defaultValue: false})\n).on(class {\n  loadingChanged(newValue) {\n    if (newValue) {\n      nprogress.start();\n    } else {\n      nprogress.done();\n    }\n  }\n});\n"],"sourceRoot":"../src"}