{"version":3,"sources":["app.js","environment.js","home.js","main.js","map.js","utils.js","resources/index.js"],"names":["AUTH0_CLIENT_ID","AUTH0_DOMAIN","App","i18n","http","lock","Auth0Lock","isAuthenticated","self","on","authResult","getProfile","idToken","error","profile","localStorage","setItem","JSON","stringify","hide","configureRouter","config","router","title","tr","options","pushState","root","map","route","moduleId","name","login","show","logout","removeItem","inject","debug","testing","Home","message","configure","Promise","longStackTraces","warnings","wForgottenReturn","aurelia","use","standardConfiguration","feature","developmentLogging","plugin","instance","i18next","setup","backend","loadPath","lng","attributes","fallbackLng","start","then","setRoot","Map","canActivate","jwtDecode","tokenIsExpired","jwt","getItem","jwtExp","exp","expiryDate","Date","setUTCSeconds"],"mappings":"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","file":"app-bundle.js","sourcesContent":["import { I18N } from 'aurelia-i18n';\nimport { HttpClient } from 'aurelia-fetch-client';\nimport { tokenIsExpired } from './utils';\n\n// TODO: Move into environment variables\nconst AUTH0_CLIENT_ID = '';\nconst AUTH0_DOMAIN = '';\n\nexport class App {\n\n  lock = new Auth0Lock(AUTH0_CLIENT_ID, AUTH0_DOMAIN);\n  isAuthenticated = false;\n\n  static inject = [I18N, HttpClient];\n\n  constructor(i18n, http) {\n    this.i18n = i18n;\n    this.http = http;\n    var self = this;\n\n    if (tokenIsExpired()) {\n      this.isAuthenticated = false;\n    } else {\n      this.isAuthenticated = true;\n    }\n\n    this.lock.on(\"authenticated\", (authResult) => {\n      self.lock.getProfile(authResult.idToken, (error, profile) => {\n        if (error) {\n          // Handle error\n          return;\n        }\n\n        localStorage.setItem('id_token', authResult.idToken);\n        localStorage.setItem('profile', JSON.stringify(profile));\n        self.isAuthenticated = true;\n        self.lock.hide();\n      });\n    });\n  }\n\n  configureRouter(config, router){\n    config.title = this.i18n.tr('title');\n    config.options.pushState = true;\n    config.options.root = '/';\n    config.map([\n      { route: '', moduleId: 'home', title: 'Home' },\n      { route: 'map', moduleId: 'map', title: 'Map', name: 'Map' }\n    ]);\n\n    this.router = router;\n  }\n\n  login() {\n    this.lock.show();\n  }\n\n  logout() {\n    localStorage.removeItem('profile');\n    localStorage.removeItem('id_token');\n    this.isAuthenticated = false;\n  }\n}\n","export default {\n  debug: true,\n  testing: true\n};\n","export class Home {\n  constructor() {\n    this.message = \"Welcome Home\";\n  }\n}\n","import environment from './environment';\nimport {I18N} from 'aurelia-i18n';\nimport Backend from 'i18next-xhr-backend';\n\n//Configure Bluebird Promises.\nPromise.config({\n  longStackTraces: environment.debug,\n  warnings: {\n    wForgottenReturn: false\n  }\n});\n\nexport function configure(aurelia) {\n  aurelia.use\n  .standardConfiguration()\n  .feature('resources');\n\n  if (environment.debug) {\n    aurelia.use.developmentLogging();\n  }\n\n  if (environment.testing) {\n    aurelia.use.plugin('aurelia-testing');\n  }\n\n  aurelia.use.plugin('aurelia-i18n', (instance) => {\n    instance.i18next.use(Backend);\n    return instance.setup({\n      backend: {\n        loadPath: './locales/{{lng}}/{{ns}}.json'\n      },\n      lng : 'id',\n      attributes : ['t','i18n'],\n      fallbackLng : 'en',\n      debug : true\n    });\n  });\n\n  aurelia.start().then(() => aurelia.setRoot());\n}\n","import { Redirect } from 'aurelia-router';\nimport { tokenIsExpired } from './utils';\n\nexport class Map {\n  constructor() {\n    this.message = \"I'm the Map\";\n  }\n\n  canActivate() {\n    if(tokenIsExpired()) {\n      return new Redirect('');\n    } else {\n      return true;\n    }\n  }\n}\n","\nconst jwtDecode = require('jwt-decode');\n\nexport function tokenIsExpired() {\n  let jwt = localStorage.getItem('id_token')\n  if(jwt) {\n    let jwtExp = jwtDecode(jwt).exp;\n    let expiryDate = new Date(0);\n    expiryDate.setUTCSeconds(jwtExp);\n\n    if(new Date() < expiryDate) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","export function configure(config) {\n  //config.globalResources([]);\n}\n"],"sourceRoot":"../src"}